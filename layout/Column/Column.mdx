import { Canvas, Story } from '@storybook/addon-docs';

import { DocsLink, GenericType, ObjectFormat } from '../../.storybook/utils';

# Column

Focus management and smooth scrolling for a vertically-oriented list of items.

## Usage

`Column` expects a list of `items` which will be laid out top-to-bottom. By default, the width of `Column`'s Item container is the same as the width of the widest item, and the height is the height passed in, the height of the wrapping FocusManager if available, or the height of the stage by default. You can change the `w` and `h` attributes to manage `width` and `height`, respectively.

```js
import { Column } from '@lightning/ui';

class BasicExample extends lng.Component {
  static _template() {
    return {
      Column: {
        type: Column,
        items: [
          // list of items
        ]
      }
    };
  }

  _getFocused() {
    return this.tag('Column');
  }
}
```

The `Column` component extends [FocusManager][fm-docs], so you need to make sure that `_getFocused` returns the `Column` component.

### Column items with changing height

If the heights of various items in the column can change (ex. an item which expands), the layout
of the items in the Column must be recalculated. To trigger this update, fire an event, called `$itemChanged`, from the
item when its height changes.
ex.

```js
class ExpandingButton extends Button {
  _focus() {
    super._focus();
    this.patch({ h: 100 });
    // triggers recalculation of Column items layout
    this.fireAncestors('$itemChanged');
  }

  _unfocus() {
    super._unfocus();
    this.patch({ h: 40 });
  }
}

class ExpandableHeightItems extends lng.Component {
  static _template() {
    return {
      Column: {
        type: Column,
        h: 500,
        items: Array.apply(null, { length: 15 }).map((_, i) => ({
          type: ExpandingButton,
          h: 40,
          w: 150,
          buttonText: `Button ${i}`
        }))
      }
    };
  }

  _getFocused() {
    return this.tag('Column');
  }
}
```

<Canvas>
  <Story id="layout-column--basic" />
</Canvas>

export const ProviderType = () => (
  <GenericType type="Promise">
    <ObjectFormat
      object={{
        items: <DocsLink id="lng.Component">lng.Component[]</DocsLink>,
        'appendItems?': 'boolean',
        'getMoreItems?': '()=>Promise'
      }}
    />
  </GenericType>
);

## API

### Properties

| name           | type                                                    | readonly | description                                                                                                                                            |
| -------------- | ------------------------------------------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| boundsMargin   | number[]                                                | true     | bounding box of the `Column`                                                                                                                           |
| plinko         | boolean                                                 | false    | When `true`, will try to determine the nearest horizontal index of the next focused item's children. Useful if `Column` has `Row`s as items.           |
| provider       | <ProviderType />                                        | false    | used for providing additional items when scroll nears the end of the column.<br />Promise returned by `getMoreItems` has the same schema as `provider` |
| items          | <DocsLink id="lng.Component">lng.Component[]</DocsLink> | false    | components to list in the column                                                                                                                       |
| itemSpacing    | number                                                  | false    | px between items                                                                                                                                       |
| keepFullScreen | boolean                                                 | true     | With scrollmount < 1 determines if we keep a full screen of items                                                                                      |
| scrollMount    | number                                                  | false    | Value between 0 and 1, determines at what point scrolling should start.                                                                                |
| selected       | <DocsLink id="lng.Component" />                         | true     | component that is currently in focus                                                                                                                   |
| selectedIndex  | number                                                  | false    | index of currently selected item                                                                                                                       |
| scrollIndex    | number                                                  | false    | Item index at which scrolling begins, provided the sum of item heights is greater than the height of the `Column`                                      |
| alwaysScroll   | boolean                                                 | false    | determines whether the column will stop scrolling as it nears the bottom to prevent white space                                                        |
| neverScroll    | boolean                                                 | false    | false if true, the column will never scroll, unless alwaysScroll is set to true, and if false, the column will apply normal scrolling logic            |
| onScreenItems  | array                                                   | true     | contains a list of items that are currently on screen (within the bounds of the container)                                                             |
| autoResize     | boolean                                                 | false    | automatically sets the height and width of the column to be the same as the Items container inside                                                     |
| lazyUpCount    | number                                                  | false    |                                                                                                                                                        | number of items to create on screen and new items will be created as user presses right on row. If you have a lot of items in a column and most are off screen, set this to the number of items that are displayed on screen by default |
|                |

### Style Properties

| name           | type                             | description                                 |
| -------------- | -------------------------------- | ------------------------------------------- |
| itemSpacing    | number                           | [See Properties section above](#properties) |
| scrollIndex    | number                           | [See Properties section above](#properties) |
| alwaysScroll   | boolean                          | [See Properties section above](#properties) |
| neverScroll    | boolean                          | [See Properties section above](#properties) |
| itemTransition | <DocsLink id="lng.Transition" /> | transition to apply to items on render      |
| plinko         | boolean                          | [See Properties section above](#properties) |

### Child Item Properties

The `Column` component will utilize the following properties on each individual element in its `items` array:

| name             | type    | readonly | default | description                                                                                                  |
| ---------------- | ------- | -------- | ------- | ------------------------------------------------------------------------------------------------------------ |
| centerInParent   | boolean | false    | false   | if set to true on an individual element in the `items` array, this will horizontally center the child        |
| skipPlinko       | boolean | false    | false   | if set to true, plinko will use the previous item to determine the horizontal index of the next focused item |
| extraItemSpacing | number  | false    | 0       | spacing in px following the item in addition to the `itemsSpacing` value                                     |

### Methods

#### onScreenEffect(onScreenItems: lng.Component[]): void

A callback that can be overridden to do something with the items that are currently on screen. This will be called on every new render.

#### scrollTo(index: number, duration: number): void

scrolls to child at `index` at a rate of `duration` in ms \* (`this.selectedIndex` - `index`)

##### Arguments

| name     | type   | required | default | description                 |
| -------- | ------ | -------- | ------- | --------------------------- |
| index    | number | true     | -       | index of child to scroll to |
| duration | number | false    | 40      | timeout value in ms         |

#### appendItems(items: lng.Component[]): void

Adds items to the end of the child list

#### appendItemsAt(items: lng.Component[], index: number): void

Adds items at a specified index of the child list

#### prependItems(items: lng.Component[]): void

Adds items to the start of the child list

#### removeItemAt(index: number): void

Removes an item (by index) from the row

##### Arguments

| name  | type                                                    | required | default | description             |
| ----- | ------------------------------------------------------- | -------- | ------- | ----------------------- |
| items | <DocsLink id="lng.Component">lng.Component[]</DocsLink> | false    | []      | list of items to append |

#### render(selected: lng.Component, previous: lng.Component): void

Called when item focus changes. Render is responsible for the scroll behavior

##### Arguments

| name     | type                                                    | required | default | description                                            |
| -------- | ------------------------------------------------------- | -------- | ------- | ------------------------------------------------------ |
| selected | <DocsLink id="lng.Component">lng.Component[]</DocsLink> | false    | -       | item to select. Required if this.plinko=true           |
| previous | <DocsLink id="lng.Component">lng.Component[]</DocsLink> | false    | -       | previously selected item. Required if this.plinko=true |

### Events

#### $columnEmpty(): void

Fires when all of the items have been removed from a `Column`

[fm-docs]: ?path=/docs/focusmanager--rows
[fm-api]: ?path=/docs/focusmanager--rows#api
